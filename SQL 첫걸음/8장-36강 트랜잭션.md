트랜잭션
=======================
# 1. 트랜잭션
**트랜잭션의 제어**
```
START TRANSACTION;
COMMIT;
ROLLBACK;
```
기본적으로 트랜잭션은 **자동 커밋** 상태이다.    
즉, ```DML```이 실행되는 경우 자동으로 ```COMMIT```이 적용된다는 것이다.      
그래서 별 다른 조치를 하지 않을 경우 트랜잭션의 기능을 활용할 수 없다.     
       
이를 방지하려면 ```START TRANSACTION```으로 수동으로 트랜잭션을 사용하겠다고 설정해야한다.    
수동 트랜잭션의 사용은 ```COMMIT```이나 ```ROLLBACK```을 만나면 종료된다.     
  
**구조**  
```
START TRANSACTION;
DML(INSERT/UPDATE/DELETE)...;
DML(INSERT/UPDATE/DELETE)...;
COMMIT / ROLLBACK;
```
  
***  
# 2. 롤백과 커밋
** ROLLBACK (롤백)** : 변경된 내용을 적용하지 않고 트랜잭션을 종료    
** COMMIT (커밋)** : 변경된 내용을 적용하고 트랜잭션을 종료    
    
이 같은 동작방법의 원리는 트랜잭션 내에서 실행된 SQL 명령은 임시 테이블 영역에서 수행되다가,  
```COMMIT``` 명령을 내리면 정식 데이터 영역으로 변경이 적용된다.       
```ROLLBACK``` 명령을 내리면 임시 데이터 영역에서의 처리는 버려진다.     
  
**구조**  
```
START TRANSACTION;
DML(INSERT/UPDATE/DELETE)...;
DML(INSERT/UPDATE/DELETE)...;
COMMIT / ROLLBACK;
```

만약 ```ROLLBACK;```을 사용하면 정상적으로 ```DML```이 작동했더라도 트랜잭션 이전 상태로 돌린다.    
반대로 에러가 발생해도 ```COMMIT```을 하면 문제없이 실행된 SQL 명령의 변경사항은 데이터베이스에 그대로 반영된다.  
  
***    
# 3. 생각해야 될 점
트랜잭션은 하나의 명령에 실행하는 것은 별로 의미가 없다.     
예를 들어 주문 테이블과 그 주문에 따른 주문 목록(상품) 테이블이 있다고 가정하자     
```  
주문 1  햄버거, 감자튀김
주문 2  치킨, 콜라, 감자튀김      


주문TBL              주문 목록TBL
________________    _____________________
|주문코드        |  | 주문코드 |  상품명  |
|_______________|   | ________|_________|
|주문 1         |   |  주문1   | 햄버거  |
|_______________|   |_________|_________|
|주문 2         |   |  주문1  | 감자튀김 | 
|_______________|   |_________|_________|    
                    |  주문2  | 치킨     |
                    |_________|_________|
                    |  주문2  | 콜라     | 
                    |_________|_________|    
                    |  주문2  | 감자튀김 | 
                    |_________|_________|    
```     
주문이 하나 들어오면 주문 상품에는 여러개의 상품을 주문한 내역의 데이터가 들어온다.      
다르게 말하면 ```주문 TBL``` 에 ```INSERT```가 들어오면      
```주문 목록TBL```에는 최소 1번 이상의 ```INSERT```가 실행된다.      
      
이렇듯 한가지 작업을 동작하기 위해서 다수의 ```SQL명령어```를 사용하는데        
이럴 때 가장 효과적인 것이 바로 **트랜잭션**인 것이다.   
    
만약 기존 작업에 대해서 처음으로 되돌리고 싶으면 ```ROLLBACK```을 하면되고  
작업에 대해서 확정 짓고 싶으면 ```COMMIT```을 사용하면 된다.    
만약 트랜잭션이 없을 경우 ```SQL문``` 하나당 ```DELETE```를 사용하면서 지웠다 다시 해야 될 것이다.    
  
이렇듯 트랜잭션은 **하나의 작업을 묶어주는 역할**을 하는 셈이다.   
