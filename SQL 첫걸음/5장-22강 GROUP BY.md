그룹화 - GROUP BY
=======================
# 1. GROUP BY로 그룹화
**구조**
```
SELECT 열 FROM 테이블명 GROUP BY 열... 
```
```GROUP BY```는 트정 열을 지정하면  
해당열에 **값**에 따른 그룹을 나누어 준다.  
우선 코드를 보자  
```
_______________________
| id | name | quantity |
|____|______|__________|
|1   |'A'   | 1        |
|____|______|__________|
|2   |'A'   | 2        |
|____|______|__________|
|3   |'B'   | 10       |
|____|______|__________|
|4   |'C'   | 3        |
|____|______|__________|
|5   |NULL  | NULL     |
|____|______|__________|
```
이렇게 생긴 테이블 구조가 있다면 이를 ```GROUP BY``` 그룹화 시켜보면
```
SELECT name FROM mytable GROUP BY name;

결과                                     
________                                        
| name |                                                    
|______|                                                            
|'A'   |                                                          
|______|                                                                                      
|'B'   |                                                         
|______|                                                       
|'C'   |                                                     
|______|                                                     
| NULL |                                                             
|______|
```
중복된 ```'A'```는 하나로 합쳐졌고 이는 마치 ```DISTINCT```와 비슷한 결과를 낸다.  
물론 내부적으로 ```DISTINCT```와 ```GROUP BY```는 많이 다르다.   
  
```GROUP BY```는 지정된 열의 값이 같은 행이 하나의 그룹으로 묶여서  
그룹화된 각각의 그룹이 하나의 집합으로서 집계함수의 인수로 넘겨진다.    
그래서 집계함수를 사용하기 위해서 주로 사용된다.  
간단히 말하면 기존에 배웠던 일반적인 집계함수는 전체를 대상으로 했다면  
```GROUP BY```로 그룹을 나누어주면 집계함수는 그룹별로 계산을 할 수 있다는 뜻이다.  
일단 코드를 보자  
  
**예시**
```
_______________________
| id | name | quantity |
|____|______|__________|
|1   |'A'   | 1        |
|____|______|__________|
|2   |'A'   | 2        |
|____|______|__________|
|3   |'B'   | 10       |
|____|______|__________|
|4   |'C'   | 3        |
|____|______|__________|
|5   |NULL  | NULL     |
|____|______|__________|

SELECT name, COUNT(name), SUM(quantity) FROM mytable GROUP BY name;

```
```
_________________________________________
| name     | COUNT(name) | SUM(quantity) |
|__________|_____________|_______________|
| NULL     |      0      |      NULL     |
|__________|_____________|_______________|
| A        |      2      |       3       |
|__________|_____________|_______________|
| B        |      1      |      10       |
|__________|_____________|_______________|
| C        |      1      |       3       |
|__________|_____________|_______________|

```
이처럼 그룹별로 ``` COUNT(name)```와 ````SUM(quantity)```를 나타내준다.

***
# 2. HAVING 조건 지정
집계함수는 ```WHERE```에서 사용을 할 수 없다.  
그 이유는 DB는 내부적으로 아래와 같이 처리를 한다.  
```
WHERE 구  -> GROUP BY구 -> SELECT 구  -> ORDER BY 구
```
그래서 ```SELECT```에서 정의되는 집계함수를 사용할 수가 없다.  
단, 기존 ```WHERE``` 구문 제한은 사용할 수 있다.  

대신에 WHERE 처럼 집계함수를 사용하면서 제한할 수 있는 ```HAVING```이 있다. 

**예시**
```
_______________________
| id | name | quantity |
|____|______|__________|
|1   |'A'   | 1        |
|____|______|__________|
|2   |'A'   | 2        |
|____|______|__________|
|3   |'B'   | 10       |
|____|______|__________|
|4   |'C'   | 3        |
|____|______|__________|
|5   |NULL  | NULL     |
|____|______|__________|


SELECT name, COUNT(name) FROM mytable
  GROUP BY name HAVING COUNT(name) = 1;
```
```
GROURP BY 만 되었을시
__________________________
| name     | COUNT(name) |
|__________|_____________|
| NULL     |      0      |
|__________|_____________|
| A        |      2      |
|__________|_____________|
| B        |      1      |
|__________|_____________|
| C        |      1      |
|__________|_____________|

```
**결과**
```
__________________________
| name     | COUNT(name) |
|__________|_____________|
| B        |      1      |
|__________|_____________|
| C        |      1      |
|__________|_____________|
```
이처럼 ```HAVING```을 이용해서 집계함수를 제한 했다.  
```
WHERE 구  -> GROUP BY구 -> HAVING구 -> SELECT 구  -> ORDER BY 구
```
참고로 ```HAVING```의 내부처리 순서는 다음과 같다.

***
# 3. 복수열의 그룹화 (SELECT 열 입력시 주의사항)
우선 GOURP BY로 특정한 열이 묶여있다면  
다른 열들은 묶인 상태가 아니다 그러므로 ```SELECT```에 기술하면 어느값을 반환할지 몰라서 ERROR 가 발생한다.
```
SELECT id,name,quantity FROM mytable GROUP BY name;
```
```name```은 그룹화 되었기에 ```SELECT```에 사용해도 되지만 ```id```와 ```quantity```은 그렇지 않다.  
그래서 만약 그룹화 되지 않은 열을 사용하고 싶으면   
```id```와 ```name```에 집계함수를 사용하던가    
GROUP BY 시에 같이 그룹화를 시켜준다.  
 
**집계 함수** 
```
SELECT MIN(id),name,SUM(quantity) FROM mytable GROUP BY name;
```
**GROUP BY** 
```
SELECT name,quantity FROM mytable GROUP BY name, quantity;
```
  
참고로 그룹화를 통해서 얻은 결과도 ```OREDER BY```로 정렬할 수 있으며    
```ORDER BY``` 마지막에 처리가 되니 집계 함수를 사용할 수 있다.  
```
SELECT name,COUNT(name),SUM(quantity) 
    FROM mytable GROUP BY name
    ORDER BY SUM(quantity) DESC;

```
