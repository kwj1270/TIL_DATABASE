뷰 작성과 삭제
=======================
# 1. 뷰
뷰 : 본래 데이터베이스 객체로 등록할 수 없는 ```SELECT 명령```을,  
객체로서 이름을 붙여 관리할 수 있도록 정의한 것  
  
간략히 말해서 ```SELECT명령어```에 이름을 붙인 것 그리고 재사용 가능   
그래서 뷰는 데이터베이스 객체화 된 **SELECT명령어**이다.  
```
SELECT * FROM (SELECT * FROM mytable) myt;

SELECT * FROM vieW_myt;
```
(SELECT * FROM mytable) myt 대신에 vieW_myt로 짧게 표현하였고  
데이터베이스 객체로서 데이터베이스에 등록해 두었다가 나중에 사용이 가능하다.   
즉, 자주 사용하거나 복잡한 ```SELECT``` 명령을 뷰로 만들어 관리하게 사용할 수 있는 것이다.  
  
## 1.1. 가상테이블
뷰는 테이블처럼 취급할 수 있지만 '실체가 존재하지 않는다'라는 의미로 **'가상테이블'**이라 불리기도 한다.    
뷰는 테이블처럼 데이터를 쓰거나 지울 수 있는 저장공간을 가지지 않는다.(물론 예외적인 방법은 있다.)     
이 때문에 테이블처럼 취급할 수 있다고 해도 ```SELECT``` 명령에서만 사용 하는 것을 권장한다.       
  
***
# 2. 뷰 작성과 삭제
뷰는 데이터베이스 객체이기에 ```DDL```로 작성하거나 삭제한다.  
```
CREATE VIEW 뷰이름 AS SELECT 명령어 ;
DROP VIEW 뷰이름 ;
```
## 2.1. 뷰의 작성
**구조**
```
CREATE VIEW 뷰이름 AS SELECT 명령어 ;
```
**예시**
```
CREATE VIEW my_veiw AS 
  SELECT * FROM mytable ;
```
별칭에 사용되는 ```AS```와 달리   
뷰 생성의 ```AS```는 ```SELECT 명령어```를 의미하니 **생략 불가능** 이다.      
    
또한 뷰는 필요에 따라 필요한 열만 지정할 수도 있다. 이때 괄호로 묶어 열을 나열한다.  
```
CREATE VIEW 뷰이름 (열명1, 열명2, ...) AS SELECT 명령어 ;
```
뷰의 열 지정을 생략하면 ```SELECT 명령어```에서 지정하는 열정보가 수집되어 자동적으로 지정된다.    
반대로 열을 지정한 경우 ```SELECT 명령어```에서는 해당 열의 수와 일치하도록 명령어 내에서 지정해주어야 한다.    
그러므로 ```SELECT 명령어```의 모든 열을 사용한다면 ```CREATE VIEW 뷰이름```시에 열 지정을 생략하자    
  
그리고 뷰는 열 이외에는 지정할 수 없으므로 자료형이나 제약도 지정할 수 없다.   
  
## 2.2. 뷰 삭제
**구조**
```
DROP VIEW 뷰이름 ;
```
**예시**
```
DROP VIEW my_view;
```
뷰를 삭제할 경우 ```DROP VIEW```를 사용한다.    
```DDL``` 이므로 뷰를 삭제할 경우 더 이상 뷰를 참조할 수도 복구할 수도 없다.    

***
# 3. 뷰의 약점
뷰는 데이터베이스 객체로서 저장장치에 저장된다.    
하지만 테이블과 달리 대용량의 저장공간을 필요로 하지 않는다.    
이유는 테이블을 저장하는 것이 아닌 **명령어**를 저장하는 것이기 때문이다.    
다만 저장공간을 소비하지 않는 대신 **CPU** 자원을 사용한다.  
이런 명령어들은 계산능력을 필요로 하기에 컴퓨터의 CPU를 사용하기 때문이다.  
    
## 3.1. 머티리얼라이즈드 뷰
뷰의 근원이 되는 테이블 안에 보관하는 데이터 양이 많은 경우,      
집계처리를 할 대도 뷰가 사용된다면 처리속도가 많이 떨어진다.        
또한 뷰를 중첩해서 사용하는 경우에도 처리 속도가 떨어지기 쉽다.        
    
이러한 문제점을 해결하기 위해 사용하는 것이 **머티리얼 라이즈드 뷰**이다.    
일반적으로 뷰는 데이터를 일시적으로 저장했다가 쿼리가 실행 종료될 때 함께 삭제된다.    
  
**머티리얼 라이즈드 뷰**는 데이터를 테이블처럼 저장장치에 저장해두고 사용한다.      
머티리얼 라이즈드 뷰는 처음 참조되었을 때 데이터를 저장해둔다.      
이후 다시 참조할 때 이전에 저장해 두었던 데이터를 그대로 사용한다.      
다만 뷰에 지정된 테이블의 데이터가 변경된 경우에는 ```SELECT``` 명령을 재실행하여 데이터를 다시 저장해야 한다.       
     
즉, 뷰에 지정된 테이블의 데이터가 자주 변경되지 않는 경우라면 머티리얼라이즈드 뷰를 사용하자.      
단 ```MySQL```에서는 사용할 수 없다. ```Oracle```과```DB2```에서만 사용할 수 있다.    
  
## 3.2. 함수 테이블
뷰를 구성하는 ```SELECT 명령```은 단독으로 실행할 수 있어야 한다.    
즉, 상관 서브쿼리처럼, 부모 쿼리와 어떤 식으로든 연관된 서브쿼리의 경우에는    
뷰의 ```SELECT 명령```으로 사용할 수 없다.    
대신 이 같은 뷰의 약점을 **함수 테이블**을 사용하여 회피할 수 있다.    
    
**함수 테이블**은 테이블을 결괏값으로 반환해주는 사용자정의 함수이다.    
함수에는 인수를 지정할 수 있기 때문에 인수의 값에 따라 ```WHERE``` 조건을 붙여 결괏값을 바꿀 수 있다.    
그에 따라 상관 서브쿼리처럼 동작할 수 있다.  


